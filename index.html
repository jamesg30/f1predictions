<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Predictions</title>
    <link rel="icon" href="/media/f1_predictions_logo.ico" type="image/x-icon">
    <!-- Bootstrap CSS (Local) -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/style.css">
    <style> 
        /* Container for the image and overlay */
        .full-width-image-container {
            position: relative; /* Allows for absolute positioning of overlay */
            width: 100%;        /* Full width of the container */
            height: 180px;      /* Fixed height for the image */
            overflow: hidden;   /* Prevents anything from overflowing */
        }

        /* Image styling */
        .full-width-image {
            width: 100%;        /* Full width of the container */
            height: 100%;       /* Full height of the container */
            object-fit: cover;  /* Ensures the image scales proportionally and fills the container */
        }

        /* Transparent overlay styling */
        .overlay {
            position: absolute;   /* Positioned relative to the parent container */
            top: 0;               /* Start at the top of the container */
            left: 0;              /* Start at the left of the container */
            width: 100%;          /* Full width of the container */
            height: 100%;         /* Full height of the container (200px) */
            background-color: rgba(0, 0, 0, 0.4); /* Transparent black overlay */
        }
        
        .centered-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;               /* White text for contrast */
    font-size: clamp(1.5rem, 5vw, 2.5rem); /* Dynamic size for responsiveness */
    font-weight: bold;          /* Bold for emphasis */
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7); /* Optional shadow for readability */
    text-align: center;         /* Ensure text is centered in smaller containers */
    z-index: 2;                 /* Above the overlay */
    white-space: nowrap;        /* Prevent wrapping */
}

    </style>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        // Initialize Supabase globally
        const supabaseUrl = 'https://mbyhlefxnjjzmiwsvnaa.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ieWhsZWZ4bmpqem1pd3N2bmFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQzODQwOTgsImV4cCI6MjA0OTk2MDA5OH0.4gcUcOfhyTspbcDn6gPxBKFSTu3zUbkBdNEhMq9MdnY';
        var supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>
</head>
<body>
    <header class="bg-light text-black py-2.5 d-flex align-items-center justify-content-between sticky-top">
        <!-- Left Section: Logo and Heading -->
        <div class="d-flex align-items-center">
            <a href="/" class="ms-2.5 me-2 d-flex align-items-center">
                <img src="/media/f1_predictions_logo.png" alt="Logo" style="height: 45px;">
            </a>
            <a href="/" class="text-decoration-none text-black">
                <h5 class="mb-0 fw-bold">F1 Predictions</h5>
            </a>
        </div>
        
        <!-- Right Section: Hamburger Menu -->
        <div class="dropdown me-3">
            <button class="btn btn-light dropdown-toggle" type="button" id="hamburgerMenu" data-bs-toggle="dropdown" aria-expanded="false">
                Menu
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="hamburgerMenu">
                <li><a class="dropdown-item" href="/">Home</a></li>
                <li><hr class="dropdown-divider"></li> <!-- Spacer -->
                <li><a class="dropdown-item" href="/form">Form</a></li>
                <li><a class="dropdown-item" href="/teams">Teams</a></li>
                <li><a class="dropdown-item" href="/results">Results</a></li>
                <li><a class="dropdown-item" href="/register">Register</a></li>
                <li><a class="dropdown-item" href="/feedback">Feedback</a></li>
                <li><a class="dropdown-item" href="/info">Info</a></li>
                <li><a class="dropdown-item" href="/archive">Archive</a></li>
                <li><hr class="dropdown-divider"></li> <!-- Spacer -->
                <li><a class="dropdown-item" href="/admin">Admin</a></li>
            </ul>
        </div>
    </header>    

    <!-- Full-Width Image Section with Centered Text -->
<section class="full-width-image-container">
    <img src="/media/ferrari_background.png" alt="Full Width Image" class="full-width-image">
    <div class="overlay"></div> <!-- Transparent black layer -->

    <!-- Centered Text -->
    <h2 class="centered-text">F1 Predictions Form</h2>
</section>

    <main class="container my-5">
        <div class="row g-4">
            <!-- Left Column: Latest Form -->
            <div class="col-md-6">
                <div class="text-center">
                    <h5 class="mb-3">Latest Form:</h5>
                    <a id="latest-form-link">
                        <button id="latest-form-button" type="button" class="btn btn-dark" disabled>Loading...</button>
                    </a>
                </div>
            </div>
    
            <!-- Right Column: Quick Links -->
        <div class="col-md-6">
            <div class="text-center">
                <h5 class="mb-3">Quick Links:</h5>
                <!-- Changed to flex-row for horizontal alignment -->
                <div class="d-flex flex-row justify-content-center gap-3">
                    <a href="/results">
                        <button type="button" class="btn btn-dark">Results</button>
                    </a>
                    <a href="/teams">
                        <button type="button" class="btn btn-dark">Teams</button>
                    </a>
                </div>
            </div>
        </div>

        </div>
    
        <!-- Next Race Section -->
        <!-- Next Race Section -->
<div class="text-center mt-5">
    <h5>Next Race:</h5>
    <div id="next-race-info" class="mt-3">
        <p>Loading next race...</p>
    </div>
    <div id="countdown-timer" class="mt-2 text-danger" style="font-size: 1.2rem; display: none;">
        <strong>Time left:</strong> <span id="countdown"></span>
    </div>
</div>

    
        <div class="container my-3 d-flex justify-content-left">
            <h4 class="mb-3">Latest Results</h4>
        </div>
        <div class="container my-4">
            <h5 class="mb-3">2024 Abu Dhabi Grand Prix Results</h5>
            
            <table>
                <tbody>
                    <td style="vertical-align: center;">
                        <p>
                            <img src="/media/awards/medal_first.png" style="float:left; width: 15px; height: 30px; image-rendering: pixelated;">
                            Damien
                        </p>
                    </td>
                    <td style="vertical-align: center;">
                        <p>
                            <img src="/media/awards/medal_second.png" style="float:left; width: 15px; height: 30px; image-rendering: pixelated;">
                            Ethan
                        </p>
                    </td>
                    <td style="vertical-align: center;">
                        <p>
                            <img src="/media/awards/medal_third.png" style="float:left; width: 15px; height: 30px; image-rendering: pixelated;">
                            Max
                        </p>
                    </td>
                </tbody>
            </table>
          
            <!-- Scrollable container -->
            <div class="table-responsive" style="overflow-x: auto; max-width: 100%; white-space: nowrap;">
                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Damien</th>
                            <th>Josh 2001</th>
                            <th>Noah</th>
                            <th>Max</th>
                            <th>Lewis</th>
                            <th>Josh 2004</th>
                            <th>Raf</th>
                            <th>Anthony</th>
                            <th>Adrian</th>
                            <th>Ethan</th>
                            <th>James</th>
                            <th style="background-color: white; border-top: none; border-bottom: none;"></th> <!-- Spacer column -->
                            <th>Results</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #e80220; color: white;">LEC</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #229971; color: white;">ALO</td>
                            <td style="background-color: #ff8001; color: white;">PIA</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #229971; color: white;">ALO</td>
                            <td style="background-color: white;"></td> <!-- Blank spacer column -->
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #e80220; color: white;">LEC</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #229971; color: white;">ALO</td>
                            <td style="background-color: #ff8001; color: white;">PIA</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #229971; color: white;">ALO</td>
                            <td style="background-color: white;"></td> <!-- Blank spacer column -->
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #e80220; color: white;">LEC</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #3671c6; color: white;">VER</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #e80220; color: white;">LEC</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                            <td style="background-color: #229971; color: white;">ALO</td>
                            <td style="background-color: white;"></td> <!-- Blank spacer column -->
                            <td style="background-color: #ff8001; color: white;">NOR</td>
                        </tr>
                        <tr>
                            <td>Totals</td>
                            <td>12</td>
                            <td>11</td>
                            <td>18</td>
                            <td>19</td>
                            <td>21</td>
                            <td>10</td>
                            <td>14</td>
                            <td>13</td>
                            <td>17</td>
                            <td>15</td>
                            <td>22</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <!-- More rows here -->
                    </tbody>
                </table>
            </div>
        </div>
        

        <div class="row g-4">
            <!-- Left Column: Latest Form -->
            <div class="col-md-6">
                <h5>Player Standings</h5>
                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1 (=)</td>
                            <td>James</td>
                            <td>58</td>
                        </tr>
                        <tr>
                            <td>2 (+1)</td>
                            <td>Ethan</td>
                            <td>57.5</td>
                        </tr>
                        <tr>
                            <td>3 (-1)</td>
                            <td>Josh 2004</td>
                            <td>52</td>
                        </tr>
                    </tbody>
                </table>
            </div>
    
            <!-- Right Column: Quick Links -->
        <div class="col-md-6">
            <h5>Team Standings</h5>
                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Team</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1 (+1)</td>
                            <td>Comeng</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>2 (-1)</td>
                            <td>Scuderia Latifi</td>
                            <td>117</td>
                        </tr>
                        <tr>
                            <td>3 (=)</td>
                            <td>Freedom Racing Inc</td>
                            <td>112</td>
                        </tr>
                    </tbody>
                </table>
        </div>
        <div class="container my-5">
            <h4 class="mb-3"><img src="/media/awards/trophy.png" style="float:left; width: 32px; height: 38px; image-rendering: pixelated;">Past Champions</h4>
            <p>
                2024 - James<br>
                2023 - Ethan<br>
                2022 - Ethan
            </p>
        </div>
    </main>
 
    <footer class="bg-light text-black text-center py-1">
        <p>&copy; 2024 F1 Predictions Form</p>
    </footer>

    <!-- Bootstrap JS Bundle (Local) -->
    <script src="/js/bootstrap.bundle.min.js"></script>

    <script>
        // Fetch the race details from form_details and calendar tables
        async function fetchRaceDetails() {
            try {
                // Fetch the race number from form_details
                const { data: formDetails, error: formDetailsError } = await supabase
                    .from('form_details')
                    .select('race_number')
                    .eq('id', 1)
                    .single();
    
                if (formDetailsError) {
                    console.error('Error fetching form details:', formDetailsError);
                    return null;
                }
    
                const raceNumber = formDetails.race_number;
    
                // Fetch the race details from the calendar table
                const { data: raceDetails, error: raceDetailsError } = await supabase
                    .from('calendar')
                    .select('*')
                    .eq('race_number', raceNumber)
                    .single();
    
                if (raceDetailsError) {
                    console.error('Error fetching race details:', raceDetailsError);
                    return null;
                }
    
                return raceDetails;
            } catch (error) {
                console.error('Error fetching race details:', error);
                return null;
            }
        }
    
        // Update the latest form button with the current race name
        async function updateLatestFormButton(raceDetails) {
            if (raceDetails) {
                document.getElementById("latest-form-button").textContent = `${raceDetails.name} GP Form`;
            } else {
                document.getElementById("latest-form-button").textContent = "Error loading form";
            }
        }
    
        // Update the next race info and initialize the countdown
        async function updateNextRaceInfo(raceDetails) {
            if (!raceDetails) {
                document.getElementById("next-race-info").innerHTML = "<p>Error loading next race.</p>";
                return;
            }
    
            const raceDate = new Date(raceDetails.date);
    
            if (isNaN(raceDate)) {
                console.error("Invalid date format for next race:", raceDetails.date);
                document.getElementById("next-race-info").innerHTML = "<p>Invalid race date.</p>";
                return;
            }
    
            const flagUrl = `/media/flags/${raceDetails.country.toLowerCase()}.png`; // Assuming flags are stored here
    
            document.getElementById("next-race-info").innerHTML = `
                <img src="${flagUrl}" alt="${raceDetails.country} Flag" style="width: 64px; height: 36px; image-rendering: pixelated;">
                <h6 class="mt-2">${raceDetails.name} GP</h6>
                <div id="countdown-timer" class="mt-2" style="font-size: 1.1rem;">
                    <strong>Time left:</strong> <span id="countdown"></span>
                </div>
            `;
    
            // Start the countdown timer
            startCountdown(raceDate);
        }
    
        // Start the countdown timer
        function startCountdown(raceDate) {
            const countdownElement = document.getElementById("countdown");
    
            function updateCountdown() {
                const now = new Date();
                const timeLeft = raceDate - now;
    
                if (timeLeft <= 0) {
                    // Countdown has ended
                    countdownElement.textContent = "Race has started!";
                    clearInterval(timer);
                    countdownElement.style.color = "green"; // Change color to indicate race started
                    return;
                }
    
                // Calculate days, hours, minutes, and seconds
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
                // Display countdown
                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
    
            // Update every second
            updateCountdown(); // Initial update
            const timer = setInterval(updateCountdown, 1000);
        }
        
        // Fetch the form status from form_details table
async function fetchFormStatus() {
    try {
        const { data: formDetails, error: formDetailsError } = await supabase
            .from('form_details')
            .select('form_enabled')
            .eq('id', 1)
            .single();

        if (formDetailsError) {
            console.error('Error fetching form status:', formDetailsError);
            return false;
        }

        return formDetails.form_enabled;
    } catch (error) {
        console.error('Error fetching form status:', error);
        return false;
    }
}

// Update the latest form button based on form status
async function updateFormButtonStatus() {
    const formEnabled = await fetchFormStatus();
    const formButton = document.getElementById('latest-form-button');

    if (formEnabled) {
        formButton.disabled = false;
    } else {
        formButton.disabled = true;
    }
}

document.addEventListener('DOMContentLoaded', async () => {
    // Fetch race details
    const raceDetails = await fetchRaceDetails();

    // Update the latest form button with the current race name
    await updateLatestFormButton(raceDetails);

    // Update the next race info and initialize the countdown
    await updateNextRaceInfo(raceDetails);

    // Update the form button status based on form_enabled
    await updateFormButtonStatus();

    // Add event listener to the form button
    const formButton = document.getElementById('latest-form-button');
    const formLink = document.getElementById('latest-form-link');

    formButton.addEventListener('click', (event) => {
        if (formButton.disabled) {
            event.preventDefault();
        } else {
            formLink.href = '/form';
        }
    });
});
    </script>

</body>
</html>